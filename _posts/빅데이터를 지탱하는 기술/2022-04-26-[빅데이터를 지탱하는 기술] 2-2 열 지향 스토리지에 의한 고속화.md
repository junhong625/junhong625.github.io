---
layout : post
title : '[빅데이터를 지탱하는 기술] 2-2 열 지향 스토리지에 의한 고속화'
subtitle : '[빅데이터를 지탱하는 기술] 정리'
gh-repo: junhong625/Study
gh-badge: [star, fork, follow]
tags : [빅데이터를 지탱하는 기술, Study]
comments: true
---

# 2-2 열 지향 스토리지에 의한 고속화
- - - 

## 데이터 베이스의 지연을 줄이기
- 데이터양의 증가에 따라 작업이 지연되지 않도록 하기 위해선 지연을 미리 예측하여 방지할 수 있는 시스템을 구성해야함.
    1. 원 데이터를 처리할 수 있는 데이터 레이크와 데이터 웨어하우스에 저장
    2. 원하는 데이터를 추출하여 데이터 마트에 저장
    3. 데이터 마트에서 항상 초 단위의 응답을 얻을 수 있도록 구성
<br>
<img height=400 src="https://user-images.githubusercontent.com/83000975/165274306-1afc40f0-93dd-402f-9424-610ba80a95d7.jpeg">

<b><sub>[3계층의 데이터 집계 시스템]</sub></b>
<br>
<br>

### 1) 데이터 처리의 지연 - 지연이 적은 데이터 마트 작성을 위한 기초 지식
- 대기 시간(지연)이 적다 : 데이터 처리의 응답이 빠르다는 표현
- 지연이 적은 데이터마트를 만드는 2가지 선택지 
    1. 모든 데이터를 메모리에 올리는 것
        - 가장 간단한 방법
        - 최근 메모리 기술로는 수 GB에서 수십 GB의 메모리가 감당할 수 있는 데이터양이라면 지연 발생 X
    2. RDB를 데이터마트로 사용 ex) MySQL, PostgreSQL 등
        - RDB는 원래 지연이 적고 많은 클라이언트의 동시접속이 가능함
        - 하지만 RDB는 메모리가 부족하면 급격한 성능저하를 보임
<br>
<br>

### 2) '압축'과 '분산'에 의해 지연 줄이기 - MPP 기술
- 고속화를 위해 사용되는 기법 : **압축**과 **분산**
- **MPP(massive parallel procesiing)** : 분산된 데이터를 읽어 들이기 위해 멀티 코어를 활용하면서 디스크 I/O를 병렬 처리하는 것 ex) Amazon Redshift, Google BigQuery
- MPP는 데이터 집계에 최적화되어 있으며 데이터 웨어하우스와 데이터 분석용 DB에서 많이 사용됨
<br>
<br>


## 열 지향 데이터 베이스 접근
### - 칼럼을 압축하여 디스크 I/O를 줄이기
- **행 지향 데이터베이스(row-oriented database)** : 일반적으로 업무에 사용되며 레코드 단위의 읽고 쓰기에 최적화 ex) Oracle, MySQL
- **열 지향 데이터베이스(column-oriented database)** : 칼럼 단위로의 데이터 집계 및 압축에 적합 ex) Teradata, Amazon Redshift

### 1) 처리량과 지연 시간
- 데이터 처리 성능을 나타내는 지표
- **처리량** : 일정 시간에 처리할 수 있는 데이터의 양 ex) 대규모 데이터 처리에서 중요시
- **지연 시간** : 데이터 처리가 끝날 때까지의 대기 시간 ex) 애드 혹 데이터 분석에서 사용
- 처리량과 지연 시간은 서로 양립하지 않음
    - 처리량은 매우 높으나 애드 혹 데이터 분석에 부적합한 경우도 있음
- 데이터 웨어하우스나 데이터 레이크에서는 처리량을 중요시 함
- 데이터 마트에서는 지연 시간을 중요시 함

### 2) 행 지향 데이터베이스 - 각 행이 디스크 상에 일련의 데이터로 기록된다
- 행 지향 데이터베이스에서는 각 행을 하나의 덩어리로 디스크에 저장
    - 새 데이터를 추가할 때 파일의 끝에 데이터를 쓸 뿐이므로 빠르게 추가 가능
- 매일 발생하는 대량의 트랜잭션을 지연 없이 처리할 수 있음
- 데이터 검색을 고속화 하기 위해 **인덱스(index)**를 만듦
    - 인덱스가 없다면 많은 디스크 I/O발생 -> 성능 저하
- 데이터 분석시에는 인덱스가 도움되지 않으므로 인덱스에 의지하지 않는 고속화 기술이 필요
<br>  
<img height=400 src="https://user-images.githubusercontent.com/83000975/165284238-1c740ce3-b632-4290-8061-6cab39b2ab43.jpeg">

<sub><b>[행 지향 데이터베이스]</b></sub>
<br>
<br>

### 3) 열 지향 데이터베이스 - 칼럼마다 데이터를 모아 두기
- 데이터 분석에서는 종종 일부 칼럼만 집계 대상이 됨
    - 열 지향 데이터베이스에서는 필요한 칼럼만을 로드하여 디스크 I/O를 줄일 수 있음
- 데이터의 압축 효율도 뛰어남
    - 행 지향 데이터베이스와 비교하면 1/10 이하로 압축할 수 있음
<br>  
<img height=400 src="https://user-images.githubusercontent.com/83000975/165284223-2943f37e-f6bb-4311-aaab-e4fabca59ca4.jpeg">

<sub><b>[열 지향 데이터베이스]</b></sub>
<br>
<br>

## MPP 데이터베이스의 접근 방식 
### - 병렬화에 의한 멀티 코어 활용하기
- MPP 아키텍처에 의한 데이터 처리의 병렬화는 쿼리 지연을 줄일 또 다른 방법
- 행 지향 데이터베이스는 많은 쿼리를 동시에 실행함으로써 여러개의 CPU 코어를 활용할 수 있지만 분산 처리된 것은 아님
- 열 지향 데이터베이스는 대량의 디스크를 읽기에 하나하나의 쿼리 실행 시간이 길어짐
    - 압축된 데이터의 전개 등으로 CPU 리소스를 필요로 하므로 멀티 코어를 활용한 고속화가 필요함
- MPP에서는 하나의 쿼리를 다수의 작은 태스크로 분해하고 이를 병렬로 실행함
<br>
<img hieght=400 src="https://user-images.githubusercontent.com/83000975/165285603-fc82399b-7e9a-4968-bd3d-5e22aacfedc7.jpeg">

<sub><b>[MPP에 의한 분산 처리]</b></sub>
<br>
<br>

### MPP 데이터베이스와 대화형 쿼리 엔진
- 쿼리가 잘 병렬화한다면, MPP를 사용한 데이터의 집계는 CPU 코어 수에 비례하여 고속화 됨
    - 단, 디스크로부터의 로드가 병목 현상이 발생하지 않도록 데이터가 고르게 분산되어야 함
- CPU와 디스크 모두를 균형 있게 늘려야 함
    - 일부 MPP 제품은 하드웨어와 소프트웨어가 통합된 제품으로 제공
- **MPP 데이터베이스(massive parallel procesiing database)** : 하나의 쿼리를 여러개의 프로세스로 병렬처리하는 데이터베이스
    - 하드웨어 수준에서 데이터 집계에 최적화된 데이터 베이스
- MPP의 아키텍처는 Hadoop과 함께 사용하기 위해 대화형 쿼리 엔진으로 채택되고 있음
    - 이 때 데이터를 저장하는 것은 분산 스토리지의 역할

### 리소스 소비를 제한하기 - 열 지향 스토리지&MPP에 의한 고속화와 주의점
- 열 지향 스토리지와 MPP의 개념을 결합하여 고속화 시 쿼리의 리소스 사용량도 많이 증가함
    - 이는 누군가 실수로 거대한 쿼리를 실행하면 모든 사용자에게 영향이 감
- 일부 상용 MPP 데이터베이스에서는 이러한 과부하가 발생하지 않도록 사용자마다 시스템 리소스를 제한할 수 있음
    - 만약 그런 기능이 없다면 주의 깊게 감시하고 그에 대한 대책을 준비해둬야 함
- **수억 레코드를 초과하는 데이터 마트의 지연을 작게 유지하기 위해서는 데이터를 열 지향 스토리지 형식을 저장해야 함**

|집계 시스템 종류|스토리지의 종류|최적의 레코드 수|
|:--|:--|:--|
|RDB|행 지향|~수천만 정도|
|MPP 데이터 베이스|열 지향(하드웨어 일체형)|수억~|
|대화형 쿼리 엔진|열 지향(분산 스토리지에 보관)|수억~|

<sub><b>[데이터 마트에 사용되는 주요 기술]</b></sub>