---
layout : post
title : '[빅데이터를 지탱하는 기술] 4-4 비구조화 데이터의 분산 스토리지'
subtitle : '[빅데이터를 지탱하는 기술] 정리'
gh-repo: junhong625/Study
gh-badge: [star, fork, follow]
tags : [빅데이터를 지탱하는 기술, Study]
comments: true
---

# 4-4 비구조화 데이터의 분산 스토리지
- - - 

## [기본전략] NoSQL 데이터베이스에 의한 데이터 활용
- 빅데이터를 위한 분산 스토리지의 조건 : 
    1. 확장성
    2. 유연성  

- 분산 스토리지의 기본 : 객체 스토리지
    - 장점 : 임의의 파일을 저장할 수 있다
    - 단점 : 
        1. 객체 스토리지 상의 파일은 교체하기 어렵다.
            - 로그 파일 같이 변경이 필요없는 파일은 괜찮지만 수시로 변경하는 용도로는 적합하지 않다.
            - 쓰기 빈도가 높은 데이터는 별도 RDB에 저장하고 정기적으로 스냅샷을 하거나 다른 분산 데이터베이스에 저장하도록 한다.
            - 중요한 데이터는 트랜잭션 처리에 대해 고려된 데이터베이스에 기록하는 것이 원칙이다.
        2. 객체 스토리지에 저장된 데이터를 집계할 수 있게 되기까지 시간이 걸린다.
            - 열 지향 스토리지를 만듦으로써 집계는 고속화되지만 열 지향 스토리지로의 변환이 시간이 걸린다.
            - 데이터를 기록하고 바로 활용하고자 하는 경우에는 실시간 집계와 검색에 적합한 데이터 저장소[ex)`NoSQL 데이터베이스`]가 필요하다.  

- `NoSQL 데이터베이스` : 특정 용도에 최적화된 저장소
<br>
<br>

## 분산 KVS - 디스크로의 쓰기 성능을 높이기
- `분산 KVS(distributed Key-Value Store)` : 모든 데이터를 키-값 쌍으로 저장하도록 설계된 데이터 저장소
    - 모든 데이터에 고유의 키를 지정하고 그것을 부하 분산을 위해 이용한다.
    - 키가 정해지면 그 값을 클러스터 내의 어느 노드에 배치할 것인지 결정한다.
        - 이 구조에 의해 노드 간에 부하를 균등하게 분산하고 노드를 증감하는 것만으로 클러스터의 성능을 변경할 수 있게 되어 있다.  
<img height=400 src="https://user-images.githubusercontent.com/83000975/168249841-830935ef-6600-434e-8766-196b5d16ad86.jpeg">
<sub><b>[분산 KVS 아키텍처의 예]</b></sub>
<br>
<br>

### Amazon DynamoDB
- Amazon DynamoDB : 
    - 항상 안정된 읽기 쓰기 성능을 제공하도록 디자인된 분산형 NoSQL 데이터베이스
    - 하나 또는 두 개의 키에 연결하는 형태로 임의의 스키마리스 데이터를 저장할 수 있다.
    - JSON과 같이 중첩된 데이터 구조도 취급할 수 있어 간단한 분산 KVS라기보다는 도큐먼트 스토어로 사용할 수 있다.  

- DynamoDB 특징 :
    - P2P 형의 분산 아키텍처를 갖고 있다
    - 미리 설정한 초 단위의 요청 수에 따라 노드가 증감
    - 데이터의 읽기 및 쓰기에 지연이 발생하면 곤란한 애플리케이션에 유용  

- DynamoDB의 데이터를 분석하기 위해서는 **Amazon EMR** 및 **Amazon Redshift** 등과 결합함으로써 Hive에 의한 배치 처리를 실행하거나 데이터웨어하우스에 데이터를 전송한다.  

- DynamoDB의 고유 기능인 **DynamoDB Streams**를 사용하면 데이터 변경을 이벤트로 외부에 전송해 실시간 스트림 처리를 할 수 있다.  

- NoSQL 데이터베이스의 특징 : 
    - 일반적으로 NoSQL 데이터베이스는 애플리케이션에서 처음에 데이터를 기록하는 장소로 이용된다.
    - 대부분의 NoSQL 데이터베이스에는 자체 데이터 집계 기능이 없어 분석을 위해서는 외부로 데이터를 추출해야 한다.
    - RDB 등과 비교하면 읽기 성능이 높기 때문에 쿼리 엔진에서 접속해도 성능상의 문제는 잘 발생하지 않는다.
    - 애드 혹 분석 등에서는 데이터를 사전에 복사하지 않고 필요시에 직접 연결하여 사용할 수 있다.
<img height=400 src="https://user-images.githubusercontent.com/83000975/168251569-33b6694c-4816-4199-82b3-f001afc49c12.jpeg">
<b><sub>[DynamoDB를 중심으로 하는 데이터 파이프라인]</sub></b>

> [DynamoDB Stream와 Kinesis Stream]
> - AWS에는 DynamoDB Stream와 비슷한 Kinesis Stream이라는 서비스가 있다.
> - Kinesis는 데이터베이스가 아니라 메시지 브로커다.
> - DynamoDB는 데이터베이스로 사용할 수 있지만 메시지 브로커는 단방향 메시지 전달에만 사용할 수 있다.
> - 그러나 메시지 브로커 쪽이 간단한 만큼 훨씬 효율적인 데이터 전송이 가능하다.

> [NoSQL사용 시 고려해야 할 ACID 특성과 CAP 정리]
> - **ACID 특성**(트랜잭션 처리에 요구되는 4가지 성질) :
>   1. 원시성(atomicity)
>   2. 일관성(consistency)
>   3. 독립성(isolation)
>   4. 내구성(durability)  
>
> - **ACID 특성**을 만족하면서 분산 시스템을 구축하는 것이 어려워 제창된 것이 **CAP 정리**  
>
> - **CAP 정리**(일반적으로 분산 시스템에서 3가지를 동시에 충족시키기 어려워 하나가 희생될 수 있다)
>   1. 일관성(consistency)
>   2. 가용성(availability)
>   3. 분단내성(partition-tolerance)  
>
> - **결과 일관성**
>   - NoSQL 데이터베이스의 일부는 **CAP 정리**의 **일관성**이나 **가용성** 중 하나를 포기한다.
>   - 그 중 자주 볼 수 있는 것이 **결과 일관성(eventual consistency)**의 개념으로 **써넣은 데이터를 바로 읽을 수 있다고는 말할 수 없다**는 것이다.
<br>
<br>

## 와이드 칼럼 스토어 - 구조화 데이터를 분석해서 저장하기
- `와이드 칼럼 스토어(wide-column store)` : 분산 KVS를 발전시켜 2개 이상의 임의의 키에 데이터를 저장할 수 있도록 한 것
    - 대표적인 `와이드 칼럼 스토어` : **Google Cloud Bigtable, Apache HBase, Apache Cassandra**  

- 특징 : 
    - **성능 향상**이 목표
    - 하나의 테이블에 가로와 세로의 2차원에 데이터를 쓸 수 있도록 한 것
    - 내부적으로 키마다 칼럼과 값이 저장되는 중첩의 데이터 구조로 되어 있다..
    - 테이블에 새로운 행과 칼럼을 얼마든지 추가할 수 있다.
    - 데이터를 집계하기에 적합하지 않다.
<br>
<br>

### Apache Cassandra
- **Cassandra**의 특징 : 
    - 내부적인 데이터 저장소로 `와이드 칼럼 스토어`를 이용
    - **CQL**이라 불리는 높은 수준의 쿼리 언어가 구현되어 있어 SQL과 동일한 감각으로 테이블을 조작할 수 있다.
    - 구조화 데이터만을 취급한다.(먼저 테이블의 스키마를 결정할 필요가 있기 때문)
    - P2P 형의 분산 아키텍처를 갖고 있으며 저장된 키에 의해 결정한 노드에 해당 키와 관련된 모든 값을 저장한다.
        - ex) 전 세계 1억명의 사용자가 있는 메시지 서비스에서 매일 수십억 레코드가 추가된다고 가정했을 때 사용자 ID를 키로 데이터를 분산하고 메시지의 타임스탬프로 레코드를 분리함으로써 사용자별 타임 라인을 구축할 수 있다.
        - **CQL**에서는 이런 거대한 테이블을 **복합 키(compound key)**를 이용하여 실현한다.
    - Cassnadra의 데이터를 분석하기 위해서는 **Hive, Presto, Spark** 등의 쿼리 엔진을 이용해 데이터를 추출해야 한다.(와이드 칼럼 스토어는 데이터를 집계하기에 적합하지 않기 때문)
<img height=400 src="https://user-images.githubusercontent.com/83000975/168257196-af513a2c-f49f-4e90-83c0-d71a48c6eaa7.jpeg">
<sub><b>[Cassandra를 중심으로 하는 데이터 파이프라인]</b></sub>
<br>
<br>

## 도큐먼트 스토어 - 스키마리스 데이터 관리하기
- `도큐먼트 스토어(document store)` : 와이드 칼럼 스토어와 함께 NoSQL 데이터베이스를 대표하는 형태  

- 특징
    - **데이터 처리의 유연성**이 목표
    - 배열과 연상 배열과 같은 중첩된 데이터 구조에 대해 인덱스를 만들거나 도큐먼트 일부만을 치환하는 식의 쿼리를 쉽게 실행할 수 있다.  

- 장점 : 스키마를 정하지 않고 데이터 처리를 할 수 있다.
    - 외부에서 들여온 데이터(참고 시스템의 데이터 및 로그 저장)를 저장하기에 적합
<br>
<br>

### MongoDB
- `MongoDB` : 오픈 소스의 **분산형 도큐먼트 스토어**로 자바스크립트나 각종 프로그래밍 언어를 사용하여 데이터를 읽고 쓸 수 있다.  

- 특징 : 
    - 성능을 우선하여 신뢰성을 희생한다.
    - 간편하여 NoSQL 데이터베이스 중 인기가 높다.
    - 여러 노드에 데이터를 분산할 수 있지만 대량의 데이터를 집계하는 데 적합하지 않다.
<br>
<br>

## 검색 엔진 - 키워드 검색으로 데이터 검색
- `검색 엔진(search engine)` : 저장된 데이터를 쿼리로 찾아낸다.  

- 특징 : 
    - NoSQL 데이터베이스와 성격이 다르지만 유사한 점이 많다.
    - 텍스트 데이터 및 스키마리스 데이터를 집계하는 데 자주 사용된다.
    - 텍스트 데이터를 전문 검색하기 위해 `역 색인`을 만든다.
        - `역 색인` : 텍스트에 포함된 단어를 분해하고 어떤 단어가 어떤 레코드에 포함되어 있는가 파악하는 인덱스를 먼저 만들어 두는 것
        - 데이터를 기록하는 시스템 부하 및 디스크 소비량은 커지지만 검색이 훨씬 고속화 된다.
    - **NoSQL 데이터베이스는 성능 향상을 위해 색인 작성을 제한**하고 있는 것과 대조적으로 **검색 엔진은 색인을 만듦으로써 데이터를 찾는 것에 특화**되어 있다.  

- 사용되는 곳 :
    - 데이터 집계에 적합하여 상태 및 보안 체크, 고객 서포트처럼 민첩성이 요구되는 용도에서 최근의 데이터를 보기 위해 사용된다.
    - 데이터를 축적하기보다는 실시간 집계 시스템의 일부로 이용된다.
<br>
<br>

### Elasticssearch
- 오픈 소스의 검색 엔진으로 인기를 끌고 있는 것  

- **Logstash(로그 수집 소프트웨어), Kibana(시각화 소프트웨어)**와 함께 **ELK 스택** 또는 **Elastic 스택**으로 자주 이용된다.  

- 특징 : 
    - 임의의 JSON 데이터를 저장할 수 있다.(도큐먼트 스토어와 비슷)
    - 아무것도 지정하지 않으면 모든 필드에 색인이 만들어진다
    - 텍스트 데이터에서는 역 색인이 구축된다.(검색 엔진의 특징)
    - 열 지향 스토리지에 대응하고 있어 데이터를 집계하기 위한 기반이 된다.  

- 간단한 도큐먼트 스토어와 비교하면 쓰기의 부하가 크고, 필요에 따라 명시적으로 스키마를 결정함으로써 색인을 무효로 하는 식의 튜닝이 필요하다.  

- 자체 쿼리 언어에 의한 고급 집계 기능을 제공하고 있다.
    - 표준 쿼리 언어는 너무 복잡하므로 Kibana 같은 프런트 엔드를 이용하거나 프로그램 안에서 호출하는 것이 주요 사용법이다.  

> [도큐먼트 스토어로서의 Elasticsearch]  

> - Elasticsearch를 검색 엔진이 아닌 일반 도큐먼트 스토어로서 임의의 스키마리스 데이터를 읽고 쓰는데 사용하는 경우도 있다.  

> - 특히, 데이터를 자주 집계하는 애플리케이션은 Elasticsearch의 집계 기능이 도움이 된다.  

> - 그러나 그 구성을 생각한다면, 어디까지나 검색과 집계를 목적으로 하는 참고용 데이터 스토어로 생각하는 것이 안전하다.
<br>
<br>

### Splunk
- 오픈 소스가 아니지만, 사용 검색 엔진이며 텍스트 데이터를 집계하기 위한 도구로 알려져 있다.  

- 특징 : 
    - `비정형 데이터`에 적합하다.
        - `비정형 데이터` : 주로 웹 서버나 네트워크 기기 등으로부터 출력되는 로그 파일이나 JSON 파일을 다루어 텍스트 처리를 해야만 분석할 수 있는 데이터
    - 검색을 실행할 때 텍스트에서 필드가 추출된다.
        - 처음에 키워드 검색을 통해 로그를 찾으면 패턴 매치에 의해 키와 값이 추출된다.
        - 그 결과, 검색할 때마다 데이터가 구조화되게 되어 있어 쿼리를 다시 작성함으로써 어떤 테이블이라도 유연하게 만들어낼 수 있다.
    - 대화형 쿼리를 사용하여 데이터를 추출, 필터링할 수 있다.
    - 교차 분석 및 시각화까지 하나의 화면에서 실행할 수 있어 텍스트 데이터를 신속하게 애드 혹 분석할 때 유용하다.
    