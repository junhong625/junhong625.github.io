---
layout : post
title : '[빅데이터를 지탱하는 기술] 2-4 데이터 마트의 기본 구조'
subtitle : '[빅데이터를 지탱하는 기술] 정리'
gh-repo: junhong625/Study
gh-badge: [star, fork, follow]
tags : [빅데이터를 지탱하는 기술, Study]
comments: true
---

# 2-4 데이터 마트의 기본 구조
- - - 

## 시각화에 적합한 데이터 마트 만들기
### - OLAP
- **OLAP(online analytical processing)** : '온라인 분석 처리'를 뜻하며 BI 도구에 있어서 핵심적인 개념 중 하나
    - 데이터 디스커버리를 위한 BI ehrnsms OLAP의 개념을 몰라도 사용할 수 있음
    - 데이터 마트를 구축할 때는 다소 사전 지식이 필요함
<br>
<br>

### 1) 다차원 모델과 OLAP 큐브
- OLAP는 데이터 집계를 효율화하는 접근 방법 중의 하나
    - OLAP에서는 '다차원 모델'의 데이터 구조를 'MDX(multidimensional expressions)'등의 쿼리 언어로 집계
- 업무 시스템에 있어서 RDB는 표 형식으로 모델링 된 데이터를 SQL로 집계함
- 데이터 분석을 위해 만들어진 다차원 데이터를 'OLAP 큐브'라고 부르며 이것을 크로스 집계하는 구조가 'OLAP'
- BI 도구는 본래 OLAP의 구조를 사용하여 데이터를 집계하기 위한 소프트웨어였고 따라서 데이터 마트도 OLAP 큐브로 작성되어 있었음
- 컴퓨터의 성능이 높지 않았을 때는 데이터의 편집에 많은 시간이 걸리는 것을 감안하여 크로스 집계의 모든 조합을 미리 계산하여 데이터 베이스 안에 캐시해두고,  
  쿼리가 실행되면 이미 집계된 결과를 반환하는 구조로 사용함
<br>
<br>

### 2) MPP 데이터베이스와 비정규화 테이블
- 최근에는 MPP 데이터베이스와 인 메모리 데이터베이스 등의 보급으로 사전에 계산해둘 필요가 없어졌음
    - 그리하여 OLAP 큐브를 위해 특별한 구조를 준비하는 것이 아니라, BI 도구와 MPP 데이터베이스를 조합하여 크로스 집계를 진행함
- BI 도구로 생각한 대로의 그래프를 만들기 위해서는 이미 존재하는 테이블을 그대로 시각화하는 것이 아니라 만들고 싶은 그래프에 맞추어 '다차원 모델'을 설계해야함
    - MPP 데이터베이스에는 '다차원 모델'의 개념이 없기 때문에 '비정규화 테이블'을 준비함 -> 기존의 OLAP와 동등한 시각화를 실현할 수 있음
- '시각화에 적합한 데이터 마트를 만드는 것'은 'BI 도구를 위한 비정규화 테이블을 만드는 프로세스'이다.
<br>
<br>

## 테이블을 비정규화하기
- **트랜잭션(transaction)** : 시간과 함께 생성되는 데이터를 기록한 것
    - 한 번 기록하면 변화하지 않음
- **마스터(master)** : 트랜잭션에서 참고되는 각종 정보
    - 상황에 따라 다시 쓰임
<img height=400 src="https://user-images.githubusercontent.com/83000975/165922037-3af99adb-3c49-4fa6-b016-4292251d52e0.jpeg">

<sub><b>[관계형 모델에 의한 테이블 설계]</b></sub>
<br>
<br>

### 1) 팩트 테이블과 디멘전 테이블
- **팩트 테이블(fact table)** : 데이터 웨어하우스에서 트랜잭션처럼 사실이 기록된 것을 지칭
    - 집계의 기반이 되는 숫자 데이터. ex) 판매액, 판매일
- **디멘전 테이블(dimension table)** : 팩트 테이블에서 참고되는 마스터 데이터 
    - 데이터를 분류하기 위한 속성값. ex) ID, 이름, 주소, 지역, 카테고리
<br>
<br>

### 2) 스타 스키마와 비정규화
- **스타 스키마(star schema)** : 팩트 테이블을 중심으로 여러 디멘전 테이블을 결합하여 별 모양이 된 스키마
    - 스타 스키마가 사용되는 이유 : 
        1. 단순하기 때문에 이해하기 쉽고 데이터 분석을 쉽게 할 수 있음
        2. 팩트 테이블을 될 수 있는 한 작게 하여 고속화를 시키기 위함
            - 팩트 테이블이 커지면 커질수록 집계 시간이 늘어나게 될 것이므로 팩트 테이블에는 ID와 같은 키만을 남겨두고 나머지는 디멘전 테이블로 옮김
- **비정규화(demormalization)** : 디멘전 테이블을 작성하기 위해 정규화에 의해 분해된 테이블을 최대한 결합하여 하나의 테이블로 정리하는 과정(정규화와는 반대의 작업)
<img height=400 src="https://user-images.githubusercontent.com/83000975/165924082-c354e4e3-377f-41cf-8e09-47afe1e68313.jpeg">

<sub><b>[데이터 마트의 스키마]</b></sub>
<br>
<br>

### 3) 비정규화 테이블
- 과거와 달리 최근에는 MPP 데이터베이스와 같은 열 지향 스토리지를 갖는 시스템이 보급됨에 따라 상황이 바뀜
    - 열 지향 스토리지는 칼럼 단위로 데이터가 저장되고 칼럼 단위로의 데이터 압축이 가능하기에 디스크 I/O억제가 가능하고 성능에 영향을 주지 않음
    - 그렇기에 데이터를 디멘전 테이블로 이동시킬 필요없이 하나의 거대한 팩트 테이블만 있으면 충분함
    - **비정규화 테이블(denormalized table)** : 스타 스키마에서 좀 더 비정규화를 진행해 모든 테이블을 결합한 팩트 테이블
- 열 지향 데이터베이스를 사용하지 않을 경우에는 비정규화 테이블이 바람직하지 않지만 데이터양이 메모리에 무리를 주지 않는다면 문제되지 않을 것임
- 데이터 마트와 달리 데이터 웨어하우스의 테이블 구조로는 스타 스키마가 우수함
    - 데이터 웨어하우스에서는 대량의 데이터가 축적되기에 팩트 테이블과 디멘전 테이블로 분리해두고
    - 데이터 마트에서는 데이터 분석을 위한 데이터만 사용하기에 결합해 비정규화 테이블을 만드는 구조로 구성
<br>
<br>

## 다차원 모델 시각화에 대비하여 테이블을 추상화하기
- **다차원 모델(multidimensional model)** : BI 도구의 기본이 되는 데이터 모델로 테이블 및 칼럼의 집합을 알기 쉽게 정리해 이름을 붙인 것
- **디멘전(dimesion)** : 크로스 집계에 있어서 행과 열을 이용하는 것
    - 주로 날짜 및 문자열의 값
- **측정값(measure)** : 숫자 데이터와 그 집계 방법을 정의하는 것
    - 주로 숫자값이 되고 sum()과 max()와 같은 집계 함수와 함께 사용됨
- 다차원 모델에 의한 데이터 집계에서는 디멘전과 측정값을 사용하여 SQL의 쿼리가 자동으로 생성됨
- 다차원 모델의 디멘전이란 차원을 의미함 
    - 데이터가 다수의 디멘전으로 이루어진 다차원 공간임을 고려할 때, 행과 열로 구성된 2차원 테이블로 표현한 것이 크로스 집계임
<img height=400 src="https://user-images.githubusercontent.com/83000975/165927109-af3f1b82-e325-47ae-834a-16746546664c.jpeg">

<sub><b>[다차원 모델에 의한 테이블과 쿼리의 관계]</b></sub>
<br>
<br>

### 모델의 정의 확장
- BI 도구를 이용한 데이터의 시각화 절차
    1. 시각화하고 싶은 측정값 및 디멘전을 결정
    2. 데이터 마트에 비정규활 테이블을 만들고 그것을 BI도구로 시각화
        - 다차원 모델의 정의 확장 가능 : 추가적으로 분류해서 집계하고 싶어졌을 때 비정규화 테이블에 새로운 칼럼을 추가할 수 있음
- BI 도구를 위한 데이터 마트 : 위와 같이 만들어진 비정규화 테이블을 모은 것
- 일단 그래프를 만들면 비정규화 테이블을 업데이트 하는 것만으로 그것을 참고하는 모든 그래프가 업데이트 됨
- 워크플로 관리 도구 등을 이용해서 데이터 마트를 정기적으로 업데이트 하여 일상적인 데이터의 움직임을 확인할 수 있음
<br>
<br>

### 브레이크 다운 분석
- **브레이크 다운 분석(breakdown analysis)** : 
    - 복잡한 데이터를 분석하기 쉽게 데이터를 몇 개의 그룹으로 분산하여 각 그룹에 내용을 정리하는 것.
    - BI 도구에서 데이터를 볼 때 어떤 숫자가 어디에서 오는 것인지 그 내역을 파악하고 싶을 때 사용.
- 데이터를 분류하기 위해 전용의 디멘전을 팩트 테이블에 추가하고 그룹명을 써 넣어 개별 대시보드를 작성
